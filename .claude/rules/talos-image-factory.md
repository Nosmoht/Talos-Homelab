---
paths:
  - "talos/talos-factory-schematic*"
  - "talos/.schematic-ids.mk"
---

# Talos Image Factory

## Schematics
- 2 schematics: `talos-factory-schematic.yaml` (standard nodes) + `talos-factory-schematic-gpu.yaml` (GPU)
- Schematic YAML defines extensions + kernel boot params; IDs are version-independent
- `.schematic-ids.mk` stores IDs (auto-generated by `make schematics`); committed to repo
- Install image URL: `factory.talos.dev/metal-installer/$(SCHEMATIC_ID):$(TALOS_VERSION)`
- Extension catalog: `curl -sS "https://factory.talos.dev/version/$TALOS_VERSION/extensions/official" | jq '.'`

## Boot Parameters
- Standard schematic: 16 boot params (performance, security, NVMe/PCIe, IOMMU) + sd-boot bootloader
- GPU schematic: 17 boot params — differs: `iommu.strict=0` (lazy for GPU DMA), `usbcore.autosuspend=-1` (USB NIC)
- All standard nodes (node-01..06) share identical kernel tuning

## Hard Constraints
- **Do NOT use `metal-installer-secureboot`** — causes boot loops on these nodes
- **Do NOT use `debugfs=off`** boot param — Talos needs debugfs; causes "failed to create root filesystem" boot loop
- gVisor is userspace runtime — no `machine.kernel.modules` entry needed (unlike DRBD or NVIDIA)

## Detection & Verification
- UEFI/SecureBoot: check `/sys/firmware/efi/` exists + `dmesg | grep "Secure boot"`
- Changing `TALOS_VERSION` in Makefile suffices to update all install image URLs — no `make schematics` needed
- Factory API only called when schematic YAML files are modified
